"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Export = (bottles, success, needauth, getauth) => {
    const drawPic = (context, url, quality) => {
        let x = quality[0];
        let y = quality[1];
        let width = quality[2];
        let height = quality[3];
        context.drawImage(url, x, y, width, height);
    };
    const drawText = (context, text, quality) => {
        let x = quality[0];
        x -= (text.length - 4) * 20;
        let y = quality[1];
        let width = quality[2];
        context.setFontSize(40);
        context.fillText(text, x, y, width);
    };
    const drawAll = (context, bottleUrl, bgUrl) => {
        const bottleHeight = 300;
        const bottleWidth = 200;
        const titleHeight = 150;
        const picWidth = 100;
        context.drawImage(bgUrl, 0, 0, 1300, 2800);
        let bottleIndex = 0;
        for (let y = 1; y <= 6; ++y) {
            for (let x = 1; x <= 5; ++x) {
                for (let i = 1; i <= bottles[bottleIndex].full; ++i) {
                    switch (i) {
                        case 1: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 85, (bottleHeight + 100) * (y - 1) + titleHeight + 195, picWidth, picWidth]);
                            break;
                        }
                        case 2: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 5, (bottleHeight + 100) * (y - 1) + titleHeight + 160, picWidth, picWidth]);
                            break;
                        }
                        case 3: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 85, (bottleHeight + 100) * (y - 1) + titleHeight + 100, picWidth, picWidth]);
                            break;
                        }
                        case 4: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 5, (bottleHeight + 100) * (y - 1) + titleHeight + 60, picWidth, picWidth]);
                            break;
                        }
                        case 5: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 63, (bottleHeight + 100) * (y - 1) + titleHeight - 10, picWidth, picWidth]);
                            break;
                        }
                    }
                }
                drawPic(context, bottleUrl, [50 * x + bottleWidth * (x - 1), (bottleHeight + 100) * (y - 1) + titleHeight, bottleWidth, bottleHeight]);
                drawText(context, bottles[bottleIndex].name, [50 * x + bottleWidth * (x - 1) + 15, (bottleHeight + 50) * y + 50 * (y - 1) + titleHeight, 300]);
                bottleIndex++;
            }
        }
    };
    const context = wx.createCanvasContext('bottleImg');
    const bottleUrl = "cloud://dxzsbottle-iu8cx.6478-dxzsbottle-iu8cx-1301327315/bottle.png";
    const backgroundUrl = "cloud://dxzsbottle-iu8cx.6478-dxzsbottle-iu8cx-1301327315/background.jpg";
    let backgroundPath;
    wx.cloud.downloadFile({
        fileID: backgroundUrl,
        success: res => {
            backgroundPath = res.tempFilePath;
            console.log("Background" + backgroundPath);
            wx.cloud.downloadFile({
                fileID: bottleUrl,
                success: res => {
                    drawAll(context, res.tempFilePath, backgroundPath);
                    context.draw(true, function () {
                        wx.canvasToTempFilePath({
                            canvasId: "bottleImg",
                            quality: 1,
                            destWidth: 1300,
                            destHeight: 2800,
                            success(res) {
                                wx.saveImageToPhotosAlbum({
                                    filePath: res.tempFilePath,
                                    success() {
                                        console.log("Saved");
                                        success();
                                    },
                                    fail(res) {
                                        console.log(res.errMsg);
                                        wx.getSetting({
                                            success(res) {
                                                if (!res.authSetting['scope.writePhotosAlbum']) {
                                                    needauth();
                                                    wx.authorize({
                                                        scope: 'scope.writePhotosAlbum',
                                                        success() {
                                                            getauth();
                                                        },
                                                        fail() {
                                                            console.error("Authorization Failed");
                                                            needauth();
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                    }
                                });
                            }
                        });
                    });
                }
            });
        }
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZXhwb3J0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQWEsUUFBQSxNQUFNLEdBQUMsQ0FBQyxPQUFjLEVBQUMsT0FBaUIsRUFBQyxRQUFrQixFQUFDLE9BQWlCLEVBQVEsRUFBRTtJQUNsRyxNQUFNLE9BQU8sR0FBRyxDQUFDLE9BQXdDLEVBQUUsR0FBVyxFQUFFLE9BQWlCLEVBQVEsRUFBRTtRQUNqRyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDbEIsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ2xCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUN0QixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFFdkIsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFFN0MsQ0FBQyxDQUFBO0lBQ0QsTUFBTSxRQUFRLEdBQUcsQ0FBQyxPQUF3QyxFQUFFLElBQVksRUFBRSxPQUFpQixFQUFRLEVBQUU7UUFDbkcsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ2xCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFBO1FBQzNCLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNsQixJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDdEIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUN2QixPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ3JDLENB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Qzt3REFDRCxJQUFJOzREQUNGLE9BQU8sQ0FBQyxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQTs0REFDckMsUUFBUSxFQUFFLENBQUE7d0RBQ1osQ0FBQztxREFDRixDQUFDLENBQUE7aURBQ0g7NENBQ0gsQ0FBQzt5Q0FDRixDQUFDLENBQUE7b0NBQ0osQ0FBQztpQ0FDRixDQUFDLENBQUE7NEJBQ0osQ0FBQzt5QkFDRixDQUFDLENBQUE7b0JBQ0osQ0FBQyxDQUFDLENBQUE7Z0JBRUosQ0FBQzthQUNGLENBQUMsQ0FBQTtRQUVKLENBQUM7S0FDQSxDQUFDLENBQUE7QUFFTixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3QgRXhwb3J0PShib3R0bGVzOiBhbnlbXSxzdWNjZXNzOiBGdW5jdGlvbixuZWVkYXV0aDogRnVuY3Rpb24sZ2V0YXV0aDogRnVuY3Rpb24pOiB2b2lkID0+e1xyXG4gIGNvbnN0IGRyYXdQaWMgPSAoY29udGV4dDogV2VjaGF0TWluaXByb2dyYW0uQ2FudmFzQ29udGV4dCwgdXJsOiBzdHJpbmcsIHF1YWxpdHk6IG51bWJlcltdKTogdm9pZCA9PntcclxuICAgIGxldCB4ID0gcXVhbGl0eVswXVxyXG4gICAgbGV0IHkgPSBxdWFsaXR5WzFdXHJcbiAgICBsZXQgd2lkdGggPSBxdWFsaXR5WzJdXHJcbiAgICBsZXQgaGVpZ2h0ID0gcXVhbGl0eVszXVxyXG5cclxuICAgIGNvbnRleHQuZHJhd0ltYWdlKHVybCwgeCwgeSwgd2lkdGgsIGhlaWdodClcclxuXHJcbiAgfVxyXG4gIGNvbnN0IGRyYXdUZXh0ID0gKGNvbnRleHQ6IFdlY2hhdE1pbmlwcm9ncmFtLkNhbnZhc0NvbnRleHQsIHRleHQ6IHN0cmluZywgcXVhbGl0eTogbnVtYmVyW10pOiB2b2lkID0+e1xyXG4gICAgbGV0IHggPSBxdWFsaXR5WzBdXHJcbiAgICB4IC09ICh0ZXh0Lmxlbmd0aCAtIDQpICogMjBcclxuICAgIGxldCB5ID0gcXVhbGl0eVsxXVxyXG4gICAgbGV0IHdpZHRoID0gcXVhbGl0eVsyXVxyXG4gICAgY29udGV4dC5zZXRGb250U2l6ZSg0MClcclxuICAgIGNvbnRleHQuZmlsbFRleHQodGV4dCwgeCwgeSwgd2lkdGgpXHJcbiAgfVxyXG4gIGNvbnN0IGRyYXdBbGwgPSAoY29udGV4dDogV2VjaGF0TWluaXByb2dyYW0uQ2FudmFzQ29udGV4dCwgYm90dGxlVXJsOiBzdHJpbmcsIGJnVXJsOiBzdHJpbmcpOiB2b2lkID0+e1xyXG4gICAgY29uc3QgYm90dGxlSGVpZ2h0ID0gMzAwXHJcbiAgICBjb25zdCBib3R0bGVXaWR0aCA9IDIwMFxyXG4gICAgY29uc3QgdGl0bGVIZWlnaHQgPSAxNTBcclxuICAgIGNvbnN0IHBpY1dpZHRoID0gMTAwXHJcblxyXG4gICAgLy8gLy/nlLvog4zmma9cclxuICAgIC8vIGNvbnRleHQucmVjdCgwLCAwLCAxMzAwLCA0MDAwKVxyXG4gICAgLy8gY29udGV4dC5zZXRGaWxsU3R5bGUoXCJ3aGl0ZVwiKVxyXG4gICAgLy8gY29udGV4dC5maWxsKClcclxuICAgIC8vIC8vY29udGV4dC5kcmF3KClcclxuICAgIC8vIGNvbnRleHQuc2V0RmlsbFN0eWxlKFwiYmxhY2tcIilcclxuICAgIGNvbnRleHQuZHJhd0ltYWdlKGJnVXJsLCAwLCAwLCAxMzAwLCAyODAwKVxyXG5cclxuICAgIGxldCBib3R0bGVJbmRleCA9IDBcclxuICAgIGZvcihsZXQgeSA9IDE7IHkgPD0gNjsgKyt5KXtcclxuICAgICAgZm9yIChsZXQgeCA9IDE7IHggPD0gNTsgKyt4KSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gYm90dGxlc1tib3R0bGVJbmRleF0uZnVsbDsgKytpKXtcclxuICAgICAgICAgIHN3aXRjaChpKXtcclxuICAgICAgICAgICAgY2FzZSAxOntcclxuICAgICAgICAgICAgICBkcmF3UGljKGNvbnRleHQsIGJvdHRsZXNbYm90dGxlSW5kZXhdLnBhdGgsIFs1MCAqIHggKyBib3R0bGVXaWR0aCAqICh4IC0gMSkgKyA4NSwgKGJvdHRsZUhlaWdodCArIDEwMCkgKiAoeSAtIDEpICsgdGl0bGVIZWlnaHQgKyAxOTUsIHBpY1dpZHRoLCBwaWNXaWR0aF0pXHJcbiAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIDI6e1xyXG4gICAgICAgICAgICAgIGRyYXdQaWMoY29udGV4dCwgYm90dGxlc1tib3R0bGVJbmRleF0ucGF0aCwgWzUwICogeCArIGJvdHRsZVdpZHRoICogKHggLSAxKSArIDUsIChib3R0bGVIZWlnaHQgKyAxMDApICogKHkgLSAxKSArIHRpdGxlSGVpZ2h0ICsgMTYwLCBwaWNXaWR0aCwgcGljV2lkdGhdKVxyXG4gICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSAzOntcclxuICAgICAgICAgICAgICBkcmF3UGljKGNvbnRleHQsIGJvdHRsZXNbYm90dGxlSW5kZXhdLnBhdGgsIFs1MCAqIHggKyBib3R0bGVXaWR0aCAqICh4IC0gMSkgKyA4NSwgKGJvdHRsZUhlaWdodCArIDEwMCkgKiAoeSAtIDEpICsgdGl0bGVIZWlnaHQgKyAxMDAsIHBpY1dpZHRoLCBwaWNXaWR0aF0pXHJcbiAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIDQ6e1xyXG4gICAgICAgICAgICAgIGRyYXdQaWMoY29udGV4dCwgYm90dGxlc1tib3R0bGVJbmRleF0ucGF0aCwgWzUwICogeCArIGJvdHRsZVdpZHRoICogKHggLSAxKSArIDUsIChib3R0bGVIZWlnaHQgKyAxMDApICogKHkgLSAxKSArIHRpdGxlSGVpZ2h0ICsgNjAsIHBpY1dpZHRoLCBwaWNXaWR0aF0pXHJcbiAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIDU6IHtcclxuICAgICAgICAgICAgICBkcmF3UGljKGNvbnRleHQsIGJvdHRsZXNbYm90dGxlSW5kZXhdLnBhdGgsIFs1MCAqIHggKyBib3R0bGVXaWR0aCAqICh4IC0gMSkgKyA2MywgKGJvdHRsZUhlaWdodCArIDEwMCkgKiAoeSAtIDEpICsgdGl0bGVIZWlnaHQtMTAsIHBpY1dpZHRoLCBwaWNXaWR0aF0pXHJcbiAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBkcmF3UGljKGNvbnRleHQsIGJvdHRsZVVybCwgWzUwICogeCArIGJvdHRsZVdpZHRoICogKHggLSAxKSwgKGJvdHRsZUhlaWdodCArIDEwMCkgKiAoeSAtIDEpICsgdGl0bGVIZWlnaHQsIGJvdHRsZVdpZHRoLCBib3R0bGVIZWlnaHRdKVxyXG4gICAgICAgIGRyYXdUZXh0KGNvbnRleHQsIGJvdHRsZXNbYm90dGxlSW5kZXhdLm5hbWUsIFs1MCp4K2JvdHRsZVdpZHRoKih4LTEpKzE1LCAoYm90dGxlSGVpZ2h0KzUwKSp5KzUwKih5LTEpK3RpdGxlSGVpZ2h0LCAzMDBdKVxyXG4gICAgICAgIGJvdHRsZUluZGV4KytcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgY29uc3QgY29udGV4dCA9IHd4LmNyZWF0ZUNhbnZhc0NvbnRleHQoJ2JvdHRsZUltZycpXHJcbiAgY29uc3QgYm90dGxlVXJsID0gXCJjbG91ZDovL2R4enNib3R0bGUtaXU4Y3guNjQ3OC1keHpzYm90dGxlLWl1OGN4LTEzMDEzMjczMTUvYm90dGxlLnBuZ1wiXHJcbiAgY29uc3QgYmFja2dyb3VuZFVybCA9IFwiY2xvdWQ6Ly9keHpzYm90dGxlLWl1OGN4LjY0NzgtZHh6c2JvdHRsZS1pdThjeC0xMzAxMzI3MzE1L2JhY2tncm91bmQuanBnXCJcclxuICBsZXQgYmFja2dyb3VuZFBhdGg6IHN0cmluZ1xyXG5cclxuICB3eC5jbG91ZC5kb3dubG9hZEZpbGUoe1xyXG4gICAgZmlsZUlEOiBiYWNrZ3JvdW5kVXJsLFxyXG4gICAgc3VjY2VzczogcmVzID0+e1xyXG4gICAgICBiYWNrZ3JvdW5kUGF0aCA9IHJlcy50ZW1wRmlsZVBhdGhcclxuICAgICAgY29uc29sZS5sb2coXCJCYWNrZ3JvdW5kXCIgKyBiYWNrZ3JvdW5kUGF0aClcclxuICAgICAgd3guY2xvdWQuZG93bmxvYWRGaWxlKHtcclxuICAgICAgICBmaWxlSUQ6IGJvdHRsZVVybCxcclxuICAgICAgICBzdWNjZXNzOiByZXMgPT57XHJcbiAgICAgICAgICBkcmF3QWxsKGNvbnRleHQsIHJlcy50ZW1wRmlsZVBhdGgsIGJhY2tncm91bmRQYXRoKVxyXG4gICAgXHJcbiAgICAgICAgICBjb250ZXh0LmRyYXcodHJ1ZSwgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgd3guY2FudmFzVG9UZW1wRmlsZVBhdGgoe1xyXG4gICAgICAgICAgICAgIGNhbnZhc0lkOiBcImJvdHRsZUltZ1wiLFxyXG4gICAgICAgICAgICAgIHF1YWxpdHk6IDEsXHJcbiAgICAgICAgICAgICAgZGVzdFdpZHRoOiAxMzAwLFxyXG4gICAgICAgICAgICAgIGRlc3RIZWlnaHQ6IDI4MDAsXHJcbiAgICAgICAgICAgICAgc3VjY2VzcyhyZXMpIHtcclxuICAgICAgICAgICAgICAgIHd4LnNhdmVJbWFnZVRvUGhvdG9zQWxidW0oe1xyXG4gICAgICAgICAgICAgICAgICBmaWxlUGF0aDogcmVzLnRlbXBGaWxlUGF0aCxcclxuICAgICAgICAgICAgICAgICAgc3VjY2VzcygpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNhdmVkXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzcygpXHJcbiAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgIGZhaWwocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzLmVyck1zZylcclxuICAgICAgICAgICAgICAgICAgICB3eC5nZXRTZXR0aW5nKHtcclxuICAgICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVzLmF1dGhTZXR0aW5nWydzY29wZS53cml0ZVBob3Rvc0FsYnVtJ10pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBuZWVkYXV0aCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgd3guYXV0aG9yaXplKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlOiAnc2NvcGUud3JpdGVQaG90b3NBbGJ1bScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0YXV0aCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmFpbCAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdXRob3JpemF0aW9uIEZhaWxlZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWVkYXV0aCgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfSlcclxuICAgIFxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuXHJcbiAgICB9XHJcbiAgICB9KVxyXG4gIFxyXG59Il19