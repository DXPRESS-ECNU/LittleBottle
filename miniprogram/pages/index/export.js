"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Export = (bottles, success, needauth, getauth) => {
    const drawPic = (context, url, quality) => {
        let x = quality[0];
        let y = quality[1];
        let width = quality[2];
        let height = quality[3];
        context.drawImage(url, x, y, width, height);
    };
    const drawText = (context, text, quality) => {
        let x = quality[0];
        let y = quality[1];
        let width = quality[2];
        context.setFontSize(30);
        context.fillText(text, x, y, width);
    };
    const drawAll = (context, bottleUrl) => {
        const bottleHeight = 300;
        const bottleWidth = 200;
        const titleHeight = 100;
        const picWidth = 100;
        context.rect(0, 0, 1300, 4000);
        context.setFillStyle("white");
        context.fill();
        context.setFillStyle("black");
        let bottleIndex = 0;
        for (let y = 1; y <= 6; ++y) {
            for (let x = 1; x <= 5; ++x) {
                for (let i = 1; i <= bottles[bottleIndex].full; ++i) {
                    switch (i) {
                        case 1: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 85, (bottleHeight + 100) * (y - 1) + titleHeight + 195, picWidth, picWidth]);
                            break;
                        }
                        case 2: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 5, (bottleHeight + 100) * (y - 1) + titleHeight + 150, picWidth, picWidth]);
                            break;
                        }
                        case 3: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 85, (bottleHeight + 100) * (y - 1) + titleHeight + 95, picWidth, picWidth]);
                            break;
                        }
                        case 4: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 5, (bottleHeight + 100) * (y - 1) + titleHeight + 50, picWidth, picWidth]);
                            break;
                        }
                        case 5: {
                            drawPic(context, bottles[bottleIndex].path, [50 * x + bottleWidth * (x - 1) + 85, (bottleHeight + 100) * (y - 1) + titleHeight - 5, picWidth, picWidth]);
                            break;
                        }
                    }
                }
                drawPic(context, bottleUrl, [50 * x + bottleWidth * (x - 1), (bottleHeight + 100) * (y - 1) + titleHeight, bottleWidth, bottleHeight]);
                drawText(context, bottles[bottleIndex].name, [50 * x + bottleWidth * (x - 1) + 40, (bottleHeight + 50) * y + 50 * (y - 1) + titleHeight, 150]);
                bottleIndex++;
            }
        }
    };
    const context = wx.createCanvasContext('bottleImg');
    const bottleUrl = "cloud://dxzsbottle-iu8cx.6478-dxzsbottle-iu8cx-1301327315/bottle.png";
    const backgroundUrl = "cloud://dxzsbottle-iu8cx.6478-dxzsbottle-iu8cx-1301327315/background.jpg";
    let backgroundPath;
    wx.cloud.downloadFile({
        fileID: backgroundUrl,
        success: res => {
            backgroundPath = res.tempFilePath;
            console.log("Background" + backgroundPath);
            wx.cloud.downloadFile({
                fileID: bottleUrl,
                success: res => {
                    drawAll(context, res.tempFilePath);
                    context.draw(true, function () {
                        wx.canvasToTempFilePath({
                            canvasId: "bottleImg",
                            quality: 1,
                            destWidth: 1300,
                            destHeight: 4000,
                            success(res) {
                                wx.saveImageToPhotosAlbum({
                                    filePath: res.tempFilePath,
                                    success() {
                                        console.log("Saved");
                                        success();
                                    },
                                    fail(res) {
                                        console.log(res.errMsg);
                                        wx.getSetting({
                                            success(res) {
                                                if (!res.authSetting['scope.writePhotosAlbum']) {
                                                    needauth();
                                                    wx.authorize({
                                                        scope: 'scope.writePhotosAlbum',
                                                        success() {
                                                            getauth();
                                                        },
                                                        fail() {
                                                            console.error("Authorization Failed");
                                                            needauth();
                                                        }
                                                    });
                                                }
                                            }
                                        });
                                    }
                                });
                            }
                        });
                    });
                }
            });
        }
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZXhwb3J0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQWEsUUFBQSxNQUFNLEdBQUMsQ0FBQyxPQUFjLEVBQUMsT0FBaUIsRUFBQyxRQUFrQixFQUFDLE9BQWlCLEVBQVEsRUFBRTtJQUNsRyxNQUFNLE9BQU8sR0FBRyxDQUFDLE9BQXdDLEVBQUUsR0FBVyxFQUFFLE9BQWlCLEVBQVEsRUFBRTtRQUNqRyxJQUFJLENBQUMsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDbEIsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ2xCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUN0QixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFFdkIsT0FBTyxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUE7SUFHN0MsQ0FBQyxDQUFBO0lBQ0QsTUFBTSxRQUFRLEdBQUcsQ0FBQyxPQUF3QyxFQUFFLElBQVksRUFBRSxPQUFpQixFQUFRLEVBQUU7UUFDbkcsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ2xCLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQTtRQUNsQixJQUFJLEtBQUssR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDdEIsT0FBTyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQTtRQUN2QixPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFBO0lBQ3JDLENBQUMsQ0FBQTtJQUNELE1BQU0sT0FBTyxHQUFHLENBQUMsT0FBd0MsRUFBRSxTQUFpQixFQUFRLEVBQUU7UUFDcEYs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RSxDQUFBO3dEQUNYLENBQUM7d0RBQ0QsSUFBSTs0REFDRixPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUE7NERBQ3JDLFFBQVEsRUFBRSxDQUFBO3dEQUNaLENBQUM7cURBQ0YsQ0FBQyxDQUFBO2lEQUNIOzRDQUNILENBQUM7eUNBQ0YsQ0FBQyxDQUFBO29DQUNKLENBQUM7aUNBQ0YsQ0FBQyxDQUFBOzRCQUNKLENBQUM7eUJBQ0YsQ0FBQyxDQUFBO29CQUNKLENBQUMsQ0FBQyxDQUFBO2dCQUVKLENBQUM7YUFDRixDQUFDLENBQUE7UUFFSixDQUFDO0tBQ0EsQ0FBQyxDQUFBO0FBRU4sQ0FBQyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IEV4cG9ydD0oYm90dGxlczogYW55W10sc3VjY2VzczogRnVuY3Rpb24sbmVlZGF1dGg6IEZ1bmN0aW9uLGdldGF1dGg6IEZ1bmN0aW9uKTogdm9pZCA9PntcclxuICBjb25zdCBkcmF3UGljID0gKGNvbnRleHQ6IFdlY2hhdE1pbmlwcm9ncmFtLkNhbnZhc0NvbnRleHQsIHVybDogc3RyaW5nLCBxdWFsaXR5OiBudW1iZXJbXSk6IHZvaWQgPT57XHJcbiAgICBsZXQgeCA9IHF1YWxpdHlbMF1cclxuICAgIGxldCB5ID0gcXVhbGl0eVsxXVxyXG4gICAgbGV0IHdpZHRoID0gcXVhbGl0eVsyXVxyXG4gICAgbGV0IGhlaWdodCA9IHF1YWxpdHlbM11cclxuXHJcbiAgICBjb250ZXh0LmRyYXdJbWFnZSh1cmwsIHgsIHksIHdpZHRoLCBoZWlnaHQpXHJcbiAgICAvL2NvbnRleHQuZHJhdyh0cnVlKVxyXG5cclxuICB9XHJcbiAgY29uc3QgZHJhd1RleHQgPSAoY29udGV4dDogV2VjaGF0TWluaXByb2dyYW0uQ2FudmFzQ29udGV4dCwgdGV4dDogc3RyaW5nLCBxdWFsaXR5OiBudW1iZXJbXSk6IHZvaWQgPT57XHJcbiAgICBsZXQgeCA9IHF1YWxpdHlbMF1cclxuICAgIGxldCB5ID0gcXVhbGl0eVsxXVxyXG4gICAgbGV0IHdpZHRoID0gcXVhbGl0eVsyXVxyXG4gICAgY29udGV4dC5zZXRGb250U2l6ZSgzMClcclxuICAgIGNvbnRleHQuZmlsbFRleHQodGV4dCwgeCwgeSwgd2lkdGgpXHJcbiAgfVxyXG4gIGNvbnN0IGRyYXdBbGwgPSAoY29udGV4dDogV2VjaGF0TWluaXByb2dyYW0uQ2FudmFzQ29udGV4dCwgYm90dGxlVXJsOiBzdHJpbmcpOiB2b2lkID0+e1xyXG4gICAgY29uc3QgYm90dGxlSGVpZ2h0ID0gMzAwXHJcbiAgICBjb25zdCBib3R0bGVXaWR0aCA9IDIwMFxyXG4gICAgY29uc3QgdGl0bGVIZWlnaHQgPSAxMDBcclxuICAgIGNvbnN0IHBpY1dpZHRoID0gMTAwXHJcblxyXG4gICAgLy/nlLvog4zmma9cclxuICAgIGNvbnRleHQucmVjdCgwLCAwLCAxMzAwLCA0MDAwKVxyXG4gICAgY29udGV4dC5zZXRGaWxsU3R5bGUoXCJ3aGl0ZVwiKVxyXG4gICAgY29udGV4dC5maWxsKClcclxuICAgIC8vY29udGV4dC5kcmF3KClcclxuICAgIGNvbnRleHQuc2V0RmlsbFN0eWxlKFwiYmxhY2tcIilcclxuICAgIFxyXG4gICAgbGV0IGJvdHRsZUluZGV4ID0gMFxyXG4gICAgZm9yKGxldCB5ID0gMTsgeSA8PSA2OyArK3kpe1xyXG4gICAgICBmb3IgKGxldCB4ID0gMTsgeCA8PSA1OyArK3gpIHtcclxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBib3R0bGVzW2JvdHRsZUluZGV4XS5mdWxsOyArK2kpe1xyXG4gICAgICAgICAgc3dpdGNoKGkpe1xyXG4gICAgICAgICAgICBjYXNlIDE6e1xyXG4gICAgICAgICAgICAgIGRyYXdQaWMoY29udGV4dCwgYm90dGxlc1tib3R0bGVJbmRleF0ucGF0aCwgWzUwICogeCArIGJvdHRsZVdpZHRoICogKHggLSAxKSArIDg1LCAoYm90dGxlSGVpZ2h0ICsgMTAwKSAqICh5IC0gMSkgKyB0aXRsZUhlaWdodCArIDE5NSwgcGljV2lkdGgsIHBpY1dpZHRoXSlcclxuICAgICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhc2UgMjp7XHJcbiAgICAgICAgICAgICAgZHJhd1BpYyhjb250ZXh0LCBib3R0bGVzW2JvdHRsZUluZGV4XS5wYXRoLCBbNTAgKiB4ICsgYm90dGxlV2lkdGggKiAoeCAtIDEpICsgNSwgKGJvdHRsZUhlaWdodCArIDEwMCkgKiAoeSAtIDEpICsgdGl0bGVIZWlnaHQgKyAxNTAsIHBpY1dpZHRoLCBwaWNXaWR0aF0pXHJcbiAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXNlIDM6e1xyXG4gICAgICAgICAgICAgIGRyYXdQaWMoY29udGV4dCwgYm90dGxlc1tib3R0bGVJbmRleF0ucGF0aCwgWzUwICogeCArIGJvdHRsZVdpZHRoICogKHggLSAxKSArIDg1LCAoYm90dGxlSGVpZ2h0ICsgMTAwKSAqICh5IC0gMSkgKyB0aXRsZUhlaWdodCArIDk1LCBwaWNXaWR0aCwgcGljV2lkdGhdKVxyXG4gICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSA0OntcclxuICAgICAgICAgICAgICBkcmF3UGljKGNvbnRleHQsIGJvdHRsZXNbYm90dGxlSW5kZXhdLnBhdGgsIFs1MCAqIHggKyBib3R0bGVXaWR0aCAqICh4IC0gMSkgKyA1LCAoYm90dGxlSGVpZ2h0ICsgMTAwKSAqICh5IC0gMSkgKyB0aXRsZUhlaWdodCArIDUwLCBwaWNXaWR0aCwgcGljV2lkdGhdKVxyXG4gICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2FzZSA1OiB7XHJcbiAgICAgICAgICAgICAgZHJhd1BpYyhjb250ZXh0LCBib3R0bGVzW2JvdHRsZUluZGV4XS5wYXRoLCBbNTAgKiB4ICsgYm90dGxlV2lkdGggKiAoeCAtIDEpICsgODUsIChib3R0bGVIZWlnaHQgKyAxMDApICogKHkgLSAxKSArIHRpdGxlSGVpZ2h0LTUsIHBpY1dpZHRoLCBwaWNXaWR0aF0pXHJcbiAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvL+eUu+eTtuWtkFxyXG4gICAgICAgIGRyYXdQaWMoY29udGV4dCwgYm90dGxlVXJsLCBbNTAgKiB4ICsgYm90dGxlV2lkdGggKiAoeCAtIDEpLCAoYm90dGxlSGVpZ2h0ICsgMTAwKSAqICh5IC0gMSkgKyB0aXRsZUhlaWdodCwgYm90dGxlV2lkdGgsIGJvdHRsZUhlaWdodF0pXHJcbiAgICAgICAgZHJhd1RleHQoY29udGV4dCwgYm90dGxlc1tib3R0bGVJbmRleF0ubmFtZSwgWzUwKngrYm90dGxlV2lkdGgqKHgtMSkrNDAsIChib3R0bGVIZWlnaHQrNTApKnkrNTAqKHktMSkrdGl0bGVIZWlnaHQsIDE1MF0pXHJcbiAgICAgICAgYm90dGxlSW5kZXgrK1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb25zdCBjb250ZXh0ID0gd3guY3JlYXRlQ2FudmFzQ29udGV4dCgnYm90dGxlSW1nJylcclxuICBjb25zdCBib3R0bGVVcmwgPSBcImNsb3VkOi8vZHh6c2JvdHRsZS1pdThjeC42NDc4LWR4enNib3R0bGUtaXU4Y3gtMTMwMTMyNzMxNS9ib3R0bGUucG5nXCJcclxuICBjb25zdCBiYWNrZ3JvdW5kVXJsID0gXCJjbG91ZDovL2R4enNib3R0bGUtaXU4Y3guNjQ3OC1keHpzYm90dGxlLWl1OGN4LTEzMDEzMjczMTUvYmFja2dyb3VuZC5qcGdcIlxyXG4gIGxldCBiYWNrZ3JvdW5kUGF0aDogc3RyaW5nXHJcblxyXG4gIHd4LmNsb3VkLmRvd25sb2FkRmlsZSh7XHJcbiAgICBmaWxlSUQ6IGJhY2tncm91bmRVcmwsXHJcbiAgICBzdWNjZXNzOiByZXMgPT57XHJcbiAgICAgIGJhY2tncm91bmRQYXRoID0gcmVzLnRlbXBGaWxlUGF0aFxyXG4gICAgICBjb25zb2xlLmxvZyhcIkJhY2tncm91bmRcIiArIGJhY2tncm91bmRQYXRoKVxyXG4gICAgICB3eC5jbG91ZC5kb3dubG9hZEZpbGUoe1xyXG4gICAgICAgIGZpbGVJRDogYm90dGxlVXJsLFxyXG4gICAgICAgIHN1Y2Nlc3M6IHJlcyA9PntcclxuICAgICAgICAgIGRyYXdBbGwoY29udGV4dCwgcmVzLnRlbXBGaWxlUGF0aClcclxuICAgIFxyXG4gICAgICAgICAgY29udGV4dC5kcmF3KHRydWUsIGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIHd4LmNhbnZhc1RvVGVtcEZpbGVQYXRoKHtcclxuICAgICAgICAgICAgICBjYW52YXNJZDogXCJib3R0bGVJbWdcIixcclxuICAgICAgICAgICAgICBxdWFsaXR5OiAxLFxyXG4gICAgICAgICAgICAgIGRlc3RXaWR0aDogMTMwMCxcclxuICAgICAgICAgICAgICBkZXN0SGVpZ2h0OiA0MDAwLFxyXG4gICAgICAgICAgICAgIHN1Y2Nlc3MocmVzKSB7XHJcbiAgICAgICAgICAgICAgICB3eC5zYXZlSW1hZ2VUb1Bob3Rvc0FsYnVtKHtcclxuICAgICAgICAgICAgICAgICAgZmlsZVBhdGg6IHJlcy50ZW1wRmlsZVBhdGgsXHJcbiAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTYXZlZFwiKVxyXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3MoKVxyXG4gICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICBmYWlsKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlcy5lcnJNc2cpXHJcbiAgICAgICAgICAgICAgICAgICAgd3guZ2V0U2V0dGluZyh7XHJcbiAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzKHJlcykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXJlcy5hdXRoU2V0dGluZ1snc2NvcGUud3JpdGVQaG90b3NBbGJ1bSddKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbmVlZGF1dGgoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHd4LmF1dGhvcml6ZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZTogJ3Njb3BlLndyaXRlUGhvdG9zQWxidW0nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzcyAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdldGF1dGgoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWwgKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiQXV0aG9yaXphdGlvbiBGYWlsZWRcIilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmVlZGF1dGgoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgIH0pXHJcbiAgICBcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcblxyXG4gICAgfVxyXG4gICAgfSlcclxuICBcclxufSJdfQ==